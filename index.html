<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workout Tracker</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #121212; color: #fff; }
  h1 { text-align: center; margin-bottom: 10px; color: #9b59b6; }
  ul { list-style: none; padding: 0; margin: 0; }
  li { display: flex; align-items: center; gap: 10px; margin: 6px 0; padding: 4px 8px; border-radius: 6px; }
  li.header { font-weight: bold; border-bottom: 2px solid #fff; }
  input[type="number"], input[type="text"], select { width: 60px; text-align: center; border-radius: 4px; border: 1px solid #666; background: #222; color: #fff; }
  input[type="text"] { flex: 1; }
  button { padding: 8px 16px; border: none; border-radius: 8px; background: #9b59b6; color: #fff; cursor: pointer; }
  .small-btn { padding: 4px 8px; font-size: 14px; border-radius: 6px; cursor: pointer; }
  .add-btn { background: #2ecc71; color: #fff; }
  .calculator { border: 1px solid #444; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
  .calculator label { margin-right: 5px; }
  .calculator div { margin: 8px 0; }
  #caloriesOutput { font-weight: bold; margin-top: 10px; }
  .days { display: flex; justify-content: space-between; margin-bottom: 10px; }
  .day-btn { flex: 1; margin: 2px; padding: 6px 0; border-radius: 6px; border: none; cursor: pointer; color: #fff; }
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
  .modal-content { background:#222; padding:20px; border-radius:8px; width:90%; max-width:400px; max-height:80%; overflow:auto; }
  .modal h3 { margin-top:0; }
  .modal label { display:block; margin:6px 0; }
  .backup-buttons { display:flex; gap:10px; margin-top:10px; flex-wrap: wrap; }
</style>
</head>
<body>

<h1>Workout Tracker</h1>

<!-- Calorie Calculator -->
<div class="calculator">
  <h2>Calorie Calculator</h2>
  <div>
    <label>Weight (kg):</label>
    <input type="number" id="weight" min="0">
  </div>
  <div>
    <label>Height (cm):</label>
    <input type="number" id="height" min="0">
  </div>
  <div>
    <label>Gender:</label>
    <select id="gender">
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  </div>
  <button onclick="calculateCalories()">Calculate</button>
  <div id="caloriesOutput"></div>
</div>

<!-- Day Selector -->
<div class="days" id="daySelector"></div>

<!-- Workout List -->
<ul id="workoutList"></ul>

<!-- Buttons -->
<button onclick="toggleEdit()" id="editBtn">Edit List</button>
<button onclick="toggleEditDays()" id="editDaysBtn">Edit Days</button>

<!-- Edit Days Modal -->
<div class="modal" id="daysModal">
  <div class="modal-content">
    <h3>Edit Workouts for <span id="modalDayName"></span></h3>
    <div id="modalWorkoutCheckboxes"></div>
    <button onclick="saveDayAssignments()">Save</button>
    <button onclick="cancelDayAssignments()">Cancel</button>
  </div>
</div>

<!-- Backup -->
<div class="backup-buttons">
  <button onclick="backupData()">Backup Data</button>
  <button onclick="restoreData()">Restore Data</button>
</div>

<script>
const dayColors = {
  "Monday":"#e74c3c",
  "Tuesday":"#e67e22",
  "Wednesday":"#f1c40f",
  "Thursday":"#2ecc71",
  "Friday":"#3498db",
  "Saturday":"#9b59b6",
  "Sunday":"#fd79a8"
};
const days = Object.keys(dayColors);
let workouts = JSON.parse(localStorage.getItem("workouts")) || [
  { reps:10, sets:3, name:"Dumbbell Curls" },
  { reps:10, sets:3, name:"Bench Presses" }
];
let calorieData = JSON.parse(localStorage.getItem("calorieData")) || {};
let dayAssignments = JSON.parse(localStorage.getItem("dayAssignments")) || {};
let currentDay = days[0];
let editMode = false;
let editDaysMode = false;
let tempAssignments = {};

const list = document.getElementById("workoutList");
const daySelectorDiv = document.getElementById("daySelector");
const editBtn = document.getElementById("editBtn");
const editDaysBtn = document.getElementById("editDaysBtn");
const daysModal = document.getElementById("daysModal");
const modalDayName = document.getElementById("modalDayName");
const modalWorkoutCheckboxes = document.getElementById("modalWorkoutCheckboxes");

// --- Render Days Buttons ---
function renderDayButtons() {
  daySelectorDiv.innerHTML = "";
  days.forEach(day => {
    const btn = document.createElement("button");
    btn.textContent = day;
    btn.className = "day-btn";
    btn.style.background = day === currentDay ? dayColors[day] : "#333";
    btn.onclick = ()=>{currentDay = day; render();};
    daySelectorDiv.appendChild(btn);
  });
}

// --- Render Workouts ---
function render() {
  renderDayButtons();
  list.innerHTML = "";
  list.innerHTML += `<li class="header"><span style="width:60px;">Reps</span><span style="width:60px;">Sets</span>Exercise</li>`;
  workouts.forEach((w,i)=>{
    const li = document.createElement("li");
    if(dayAssignments[currentDay]?.includes(i)) li.style.background = dayColors[currentDay];
    li.innerHTML = editMode ? 
      `<input type="number" min="0" value="${w.reps}" onchange="updateReps(${i},this.value)">
       <input type="number" min="0" value="${w.sets}" onchange="updateSets(${i},this.value)">
       <input type="text" value="${w.name}" onchange="updateName(${i},this.value)">
       <button class="small-btn" onclick="removeWorkout(${i})">X</button>` :
      `<input type="number" min="0" value="${w.reps}" onchange="updateReps(${i},this.value)">
       <input type="number" min="0" value="${w.sets}" onchange="updateSets(${i},this.value)">
       ${w.name}`;
    list.appendChild(li);
  });
  if(editMode){
    const liAdd = document.createElement("li");
    liAdd.innerHTML = `<button class="add-btn" onclick="addWorkout()">+ Add Workout</button>`;
    list.appendChild(liAdd);
  }
  saveAll();
}

// --- Edit workouts functions ---
function toggleEdit(){ editMode=!editMode; editBtn.textContent = editMode?"Done":"Edit List"; render();}
function addWorkout(){ workouts.push({reps:0,sets:0,name:"New Exercise"}); render();}
function removeWorkout(i){ workouts.splice(i,1); render();}
function updateReps(i,v){ workouts[i].reps = Math.max(0,Number(v)); saveAll();}
function updateSets(i,v){ workouts[i].sets = Math.max(0,Number(v)); saveAll();}
function updateName(i,v){ workouts[i].name=v; saveAll();}

// --- Calorie calculator ---
function calculateCalories(){
  const weight = Number(document.getElementById("weight").value);
  const height = Number(document.getElementById("height").value);
  const gender = document.getElementById("gender").value;
  if(!weight || !height){document.getElementById("caloriesOutput").textContent="Please enter weight and height.";return;}
  let calories = gender==="male"?10*weight+6.25*height-5*25+5:10*weight+6.25*height-5*25-161;
  document.getElementById("caloriesOutput").textContent=`Estimated daily calories: ${Math.round(calories)} kcal`;
  calorieData={weight,height,gender,calories};
  saveAll();
}

// --- Edit Days Modal ---
function toggleEditDays(){
  editDaysMode = true;
  tempAssignments = JSON.parse(JSON.stringify(dayAssignments));
  modalDayName.textContent = currentDay;
  modalWorkoutCheckboxes.innerHTML="";
  workouts.forEach((w,i)=>{
    const checked = tempAssignments[currentDay]?.includes(i)?"checked":"";
    modalWorkoutCheckboxes.innerHTML += `<label><input type="checkbox" value="${i}" ${checked}> ${w.name}</label>`;
  });
  daysModal.style.display="flex";
}
function saveDayAssignments(){
  const checkedBoxes = [...modalWorkoutCheckboxes.querySelectorAll("input:checked")].map(cb=>Number(cb.value));
  tempAssignments[currentDay]=checkedBoxes;
  dayAssignments = tempAssignments;
  daysModal.style.display="none";
  editDaysMode=false;
  render();
}
function cancelDayAssignments(){ daysModal.style.display="none"; editDaysMode=false; render();}

// --- Backup/Restore ---
function backupData(){
  const data = {workouts,calorieData,dayAssignments};
  const blob = new Blob([JSON.stringify(data, null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download="workout_backup.json"; a.click();
  URL.revokeObjectURL(url);
}
function restoreData(){
  const input = document.createElement("input");
  input.type="file";
  input.accept=".json";
  input.onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e=>{
      try{
        const data = JSON.parse(e.target.result);
        workouts=data.workouts||[];
        calorieData=data.calorieData||{};
        dayAssignments=data.dayAssignments||{};
        document.getElementById("weight").value = calorieData.weight||"";
        document.getElementById("height").value = calorieData.height||"";
        document.getElementById("gender").value = calorieData.gender||"male";
        if(calorieData.calories) document.getElementById("caloriesOutput").textContent=`Estimated daily calories: ${Math.round(calorieData.calories)} kcal`;
        render();
      }catch(err){alert("Invalid file");}
    };
    reader.readAsText(file);
  };
  input.click();
}

// --- Save All ---
function saveAll(){
  localStorage.setItem("workouts",JSON.stringify(workouts));
  localStorage.setItem("calorieData",JSON.stringify(calorieData));
  localStorage.setItem("dayAssignments",JSON.stringify(dayAssignments));
}

// --- Restore on load ---
window.onload = ()=>{
  if(calorieData.weight) document.getElementById("weight").value = calorieData.weight;
  if(calorieData.height) document.getElementById("height").value = calorieData.height;
  if(calorieData.gender) document.getElementById("gender").value = calorieData.gender;
  render();
};
</script>

</body>
</html>
